
  deepdive.db.default {
    driver: "org.postgresql.Driver"
    url: "jdbc:postgresql://"${PGHOST}":"${PGPORT}"/"${DBNAME}
    user: ${PGUSER}
    password: ${PGPASSWORD}
    dbname: ${DBNAME}
    host: ${PGHOST}
    port: ${PGPORT}
    incremental_mode: ORIGINAL
    }
    


      deepdive.schema.variables {
        is_negative.label: Boolean
      }
    

      deepdive.extraction.extractors.ext_is_somewhat_positive {
        cmd: """

	deepdive create view is_somewhat_positive as 'SELECT DISTINCT R0.review_id, 0 AS id, 
CASE WHEN R0.sentiment = 3 THEN true
     ELSE false
END AS label
          FROM reviews R0
        
          '
	
        """
          output_relation: "is_somewhat_positive"
        style: "cmd_extractor"
          
          input_relations: [
            reviews
          ]
      }
    

      deepdive.extraction.extractors.ext_is_negative {
        cmd: """

	# TODO use temporary table
	deepdive create table "is_negative"
	deepdive sql 'INSERT INTO is_negative SELECT DISTINCT R0.review_id, 0 AS id, 
CASE WHEN R0.sentiment = 0 THEN true
     ELSE false
END AS label
          FROM reviews R0
        
          '
	# TODO rename temporary table to replace output_relation
	
        """
          output_relation: "is_negative"
        style: "cmd_extractor"
          
          input_relations: [
            reviews
          ]
      }
    

      deepdive.extraction.extractors.ext_is_positive {
        cmd: """

	deepdive create view is_positive as 'SELECT DISTINCT R0.review_id, 0 AS id, 
CASE WHEN R0.sentiment = 4 THEN true
     ELSE false
END AS label
          FROM reviews R0
        
          '
	
        """
          output_relation: "is_positive"
        style: "cmd_extractor"
          
          input_relations: [
            reviews
          ]
      }
    

      deepdive.extraction.extractors.ext_is_somewhat_negative {
        cmd: """

	deepdive create view is_somewhat_negative as 'SELECT DISTINCT R0.review_id, 0 AS id, 
CASE WHEN R0.sentiment = 1 THEN true
     ELSE false
END AS label
          FROM reviews R0
        
          '
	
        """
          output_relation: "is_somewhat_negative"
        style: "cmd_extractor"
          
          input_relations: [
            reviews
          ]
      }
    

      deepdive.extraction.extractors.ext_is_neutral {
        cmd: """

	deepdive create view is_neutral as 'SELECT DISTINCT R0.review_id, 0 AS id, 
CASE WHEN R0.sentiment = 2 THEN true
     ELSE false
END AS label
          FROM reviews R0
        
          '
	
        """
          output_relation: "is_neutral"
        style: "cmd_extractor"
          
          input_relations: [
            reviews
          ]
      }
    

        deepdive.extraction.extractors.ext_review_feature_by_extract_features {
          input: """ SELECT R0.review_id AS "reviews.R0.review_id", R0.sentence AS "reviews.R0.sentence"
FROM reviews R0
        
          """
          output_relation: "review_feature"
          udf: ${APP_HOME}"/udf/extract_features.py"
          style: "tsv_extractor" 
          
          input_relations: [
            reviews
          ]
          input_batch_size: ${INPUT_BATCH_SIZE}
          parallelism: ${PARALLELISM}
        }
      

        deepdive.inference.factors.inf_istrue_is_negative {
          input_query: """
          SELECT R0.id AS "is_negative.R0.id" , R2.feature AS "dd_weight_column_0" 
          FROM is_negative R0, reviews R1, review_feature R2
        WHERE R1.review_id = R0.index  AND R2.id = R0.index """
          function: "Imply(is_negative.R0.label)"
          weight: "?(dd_weight_column_0)"
          dependencies: [ "ext_review_feature_by_extract_features" ]
          input_relations: [
            is_negative
            reviews
            review_feature
          ]
        }
      
deepdive.pipeline.run: ${PIPELINE}
deepdive.pipeline.pipelines.extraction: [
  ext_is_somewhat_negative
  ext_is_negative
  ext_review_feature_by_extract_features
  ext_is_somewhat_positive
  ext_is_neutral
  ext_is_positive
]
deepdive.pipeline.pipelines.inference: [
  inf_istrue_is_negative
]
deepdive.pipeline.pipelines.endtoend: [
  ext_is_somewhat_negative
  ext_is_negative
  ext_review_feature_by_extract_features
  ext_is_somewhat_positive
  ext_is_neutral
  ext_is_positive
  inf_istrue_is_negative
]
deepdive.calibration.holdout_fraction:0.25
deepdive.sampler.sampler_args: "-l 1000 -s 1 -i 1000 --alpha 0.01 --sample_evidence"
deepdive.schema {"relations" : {"is_somewhat_positive" : {"type" : "view", "columns" : {"column_0" : {"type" : "UNKNOWN", "index" : 0}}}, "is_negative" : {"columns" : {"index" : {"type" : "int", "index" : 0}}, "variable_type" : "boolean", "variable_cardinality" : 2}, "is_positive" : {"type" : "view", "columns" : {"column_0" : {"type" : "UNKNOWN", "index" : 0}}}, "reviews" : {"columns" : {"review_id" : {"type" : "int", "index" : 0}, "sentence" : {"type" : "text", "index" : 1}, "sentiment" : {"type" : "int", "index" : 2}}}, "is_somewhat_negative" : {"type" : "view", "columns" : {"column_0" : {"type" : "UNKNOWN", "index" : 0}}}, "is_neutral" : {"type" : "view", "columns" : {"column_0" : {"type" : "UNKNOWN", "index" : 0}}}, "review_feature" : {"columns" : {"id" : {"type" : "int", "index" : 0}, "feature" : {"type" : "text", "index" : 1}}}}}
